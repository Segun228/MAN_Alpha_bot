from app.handlers.router import admin_router as router
import logging
import re
import zipfile
import io
import json
from aiogram.types import Message, CallbackQuery, BufferedInputFile
from aiogram.filters import CommandStart, Command, StateFilter
from aiogram import F
from typing import Dict, Any
from aiogram.fsm.context import FSMContext
from aiogram import Router, Bot
from aiogram.exceptions import TelegramAPIError
from io import BytesIO
import asyncio

from aiogram.types import InputFile

from app.keyboards import inline_user as inline_keyboards

from app.states.states import Send

from aiogram.types import BufferedInputFile

from app.filters.IsAdmin import IsAdmin

from app.requests.user.login import login
from app.requests.helpers.get_cat_error import get_cat_error_async

from app.requests.helpers.get_cat_error import get_cat_error_async

from app.requests.user.get_alive import get_alive
from app.requests.user.make_admin import make_admin

from app.kafka.utils import build_log_message


import re
from typing import Optional

def escape_markdown_v2(text: str, version: int = 2) -> str:
    if not text:
        return ""
    if version == 1:
        escape_chars = r'_*`['
    else:
        escape_chars = r'_*[]()~`>#+-=|{}.!'
    pattern = r'([{}])'.format(re.escape(escape_chars))
    escaped_text = re.sub(pattern, r'\\\1', text)
    return escaped_text

#===========================================================================================================================
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
#===========================================================================================================================


@router.message(Command("start"))
async def cmd_start(message: Message):
    await build_log_message(
        telegram_id=message.from_user.id,
        action="command",
        source="command", 
        payload="start"
    )
    welcome_text = """
    *üöÄ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Business Analyst AI!*

    –Ø –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π AI-–ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –±–∏–∑–Ω–µ—Å–∞. –ü–æ–º–æ–≥–∞—é –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–¥–µ–∏ –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –ø—É—Ç–∏ –¥–ª—è —Ä–æ—Å—Ç–∞.

    *üéØ –ß—Ç–æ —è –º–æ–≥—É –¥–ª—è –≤–∞—Å —Å–¥–µ–ª–∞—Ç—å:*

    ‚Ä¢ *üìä –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å* –≤–∞—à–∏ –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏
    ‚Ä¢ *üí° –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å* –Ω–æ–≤—ã–µ –∏–¥–µ–∏ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è  
    ‚Ä¢ *üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å* –æ—Ç—á–µ—Ç—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã
    ‚Ä¢ *üîç –í—ã—è–≤–∏—Ç—å* —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
    ‚Ä¢ *üéØ –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å* –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏–π

    *üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã:*
    - –ë–∏–∑–Ω–µ—Å-–∞–Ω–∞–ª–∏—Ç–∏–∫–∞
    - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–¥–µ–π  
    - –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
    - SWOT-–∞–Ω–∞–ª–∏–∑
    - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

    *üîç –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã:*
    /help - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
    /info - –æ –±–æ—Ç–µ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö  
    /contacts - —Å–≤—è–∑—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π

    *–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –Ω–∏–∂–µ —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É! üëá*
    """
    welcome_text = escape_markdown_v2(
        welcome_text
    )
    
    await message.reply(
        text=welcome_text,
        reply_markup=inline_keyboards.main_menu,#TODO
        parse_mode='MarkdownV2'
    )


@router.callback_query(F.data == "restart")
async def callback_start_admin(callback: CallbackQuery, state: FSMContext):
    await state.clear()
    data = await login(telegram_id=callback.from_user.id)
    if data is None:
        logging.error("Error while logging in")
        await callback.message.answer("–ë–æ—Ç –µ—â–µ –Ω–µ –ø—Ä–æ—Å–Ω—É–ª—Å—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–µ–º–Ω–æ–≥–æ –ø–æ–¥–æ–∂–¥–∞—Ç—å üòî", reply_markup=inline_keyboards.restart)
        return
    
    await state.update_data(telegram_id=data.get("telegram_id"))
    reply_string = escape_markdown_v2(
        "üéØ *–ß—Ç–æ —è –º–æ–≥—É –¥–ª—è –≤–∞—Å —Å–¥–µ–ª–∞—Ç—å:*\n\n"
        "‚Ä¢ *üìä –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å* –≤–∞—à–∏ –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫–∏\n"
        "‚Ä¢ *üí° –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å* –Ω–æ–≤—ã–µ –∏–¥–µ–∏ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è\n"  
        "‚Ä¢ *üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å* –æ—Ç—á–µ—Ç—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã\n"
        "‚Ä¢ *üîç –í—ã—è–≤–∏—Ç—å* —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏\n"
        "‚Ä¢ *üéØ –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å* –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏–π\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –Ω–∏–∂–µ —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É! üëá"
    )
    await callback.message.reply("–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é! üëã")
    await callback.message.answer("–Ø –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π AI-–ø–æ–º–æ—â–Ω–∏–∫ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –±–∏–∑–Ω–µ—Å–∞!")
    await callback.message.answer(
        reply_string,
        parse_mode='MarkdownV2',
        reply_markup=inline_keyboards.main_menu  #TODO
    )
    
    await callback.answer()
    await build_log_message(
        telegram_id=callback.from_user.id,
        action="callback",
        source="inline",
        payload="restart"
    )

@router.message(Command("help"))
async def cmd_help(message: Message):
    await build_log_message(
        telegram_id=message.from_user.id,
        action="command", 
        source="command",
        payload="help"
    )
    
    help_text = """
        ü§ñ *–ë–∏–∑–Ω–µ—Å-–ê–Ω–∞–ª–∏—Ç–∏–∫ AI* - –≤–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ —Ä–∞–∑–≤–∏—Ç–∏–∏ –±–∏–∑–Ω–µ—Å–∞!

        –í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –æ–±—â–∞—Ç—å—Å—è —Å –Ω–∏–º –∫–∞–∫ —Å —á–∞—Ç-–±–æ—Ç–æ–º, –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –≤ —á–∞—Ç –≤–∞—à –≤–æ–ø—Ä–æ—Å

        *üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:*

        ‚Ä¢ *–ê–Ω–∞–ª–∏–∑ –±–∏–∑–Ω–µ—Å-–º–µ—Ç—Ä–∏–∫* - –æ—Ü–µ–Ω–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
        ‚Ä¢ *–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–¥–µ–π* - –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è —Ä–æ—Å—Ç–∞  
        ‚Ä¢ *–°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö* - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–æ–≤ –∏ –¥–∏–∞–ª–æ–≥–æ–≤
        ‚Ä¢ *SWOT-–∞–Ω–∞–ª–∏–∑* - –≤—ã—è–≤–ª–µ–Ω–∏–µ —Å–∏–ª—å–Ω—ã—Ö –∏ —Å–ª–∞–±—ã—Ö —Å—Ç–æ—Ä–æ–Ω
        ‚Ä¢ *–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏* - –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–≤–µ—Ç—ã –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é

        *üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:*
        - –ê–Ω–∞–ª–∏–∑ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
        - –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞  
        - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤
        - –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤
        - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º–∏

        *üí° –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–æ—Ç–æ–º:*
        1. –í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π —Ä–∞–∑–¥–µ–ª –≤ –º–µ–Ω—é
        2. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –±–æ—Ç–∞
        3. –ü–æ–ª—É—á–∞–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ insights

        –ù–∞—á–Ω–∏—Ç–µ —Å –∫–æ–º–∞–Ω–¥—ã /start –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º!
    """
    help_text = escape_markdown_v2(
        help_text
    )
    await message.reply(
        text=help_text,
        reply_markup=inline_keyboards.home,
        parse_mode='MarkdownV2'
    )

@router.message(Command("contacts"))
async def cmd_contacts(message: Message):
    await build_log_message(
        telegram_id=message.from_user.id,
        action="command",
        source="command", 
        payload="contacts"
    )
    contacts_text = """
    *üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏*

    *ü§ù –†–µ–∫–ª–∞–º–∞ –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ:*
    @dianabol_metandienon_enjoyer

    *ü§ù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞:*
    @mattwix

    *ü§ù –ü—Ä–æ–±–ª–µ–º–º—ã —Å –ò–ò:*
    @andy_andy13

    *‚è∞ –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏:*
    –ü–Ω-–ü—Ç: 8:00 - 18:00 (–ú–°–ö)
    –°–±-–í—Å: –ø–æ –∑–∞–ø—Ä–æ—Å—É

    *üöÄ –ú—ã –ø–æ–º–æ–∂–µ–º:*
    ‚Ä¢ –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å —Ä–µ–∫–ª–∞–º—É –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ
    ‚Ä¢ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
    ‚Ä¢ –û—Ç–≤–µ—Ç–∏–º –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ
    ‚Ä¢ –ü—Ä–∏–º–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é
    ‚Ä¢ –†–µ—à–∏–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

    *üìß –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã —Å–≤—è–∑–∏:*
    –î–ª—è —Å—Ä–æ—á–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Telegram
    """
    contacts_text = escape_markdown_v2(
        contacts_text
    )
    await message.reply(
        text=contacts_text,
        reply_markup=inline_keyboards.home,
        parse_mode='MarkdownV2'
    )

@router.message(Command("info"))
async def cmd_info(message: Message):
    await build_log_message(
        telegram_id=message.from_user.id,
        action="command",
        source="command",
        payload="info"
    )
    
    info_text = """
        *üè¢ –û Business Analyst AI*

        *üéØ –ù–∞—à–∞ –º–∏—Å—Å–∏—è:*
        –ü–æ–º–æ–≥–∞—Ç—å –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—è–º –ø—Ä–∏–Ω–∏–º–∞—Ç—å –≤–∑–≤–µ—à–µ–Ω–Ω—ã–µ –±–∏–∑–Ω–µ—Å-—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏ AI-–∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

        *üîç –ß—Ç–æ –º—ã –¥–µ–ª–∞–µ–º:*
        ‚Ä¢ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∞—à–∏ –±–∏–∑–Ω–µ—Å-–ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
        ‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ–º —Ä–∞–∑—Ä–æ–∑–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ  
        ‚Ä¢ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∏–¥–µ–∏ –¥–ª—è —Ä–æ—Å—Ç–∞
        ‚Ä¢ –í—ã—è–≤–ª—è–µ–º —Å–∫—Ä—ã—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
        ‚Ä¢ –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è

        *üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:*
        ‚úÖ *–ü—Ä–æ—Å—Ç–æ—Ç–∞* - –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        ‚úÖ *–°–∫–æ—Ä–æ—Å—Ç—å* - –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞  
        ‚úÖ *–¢–æ—á–Ω–æ—Å—Ç—å* - –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö AI-–º–æ–¥–µ–ª–µ–π
        ‚úÖ *–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å* - –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

        *üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:*
        ‚Ä¢ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —è–∑—ã–∫–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ (LLM)
        ‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
        ‚Ä¢ –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è
        ‚Ä¢ –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

        *üíº –î–ª—è –∫–æ–≥–æ –Ω–∞—à –±–æ—Ç:*
        ‚Ä¢ –ú–∞–ª—ã–π –∏ —Å—Ä–µ–¥–Ω–∏–π –±–∏–∑–Ω–µ—Å
        ‚Ä¢ –°—Ç–∞—Ä—Ç–∞–ø—ã –∏ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–∏  
        ‚Ä¢ –§—Ä–∏–ª–∞–Ω—Å–µ—Ä—ã –∏ —Å–∞–º–æ–∑–∞–Ω—è—Ç—ã–µ
        ‚Ä¢ –í—Å–µ, –∫—Ç–æ —Ö–æ—á–µ—Ç —Ä–∞–∑–≤–∏–≤–∞—Ç—å —Å–≤–æ–π –±–∏–∑–Ω–µ—Å

        *–ù–∞—á–Ω–∏—Ç–µ —É–ª—É—á—à–∞—Ç—å —Å–≤–æ–π –±–∏–∑–Ω–µ—Å —É–∂–µ —Å–µ–≥–æ–¥–Ω—è! üöÄ*
    """
    info_text = escape_markdown_v2(
        info_text
    )
    await message.reply(
        text=info_text,
        reply_markup=inline_keyboards.home,
        parse_mode='Markdown'
    )

@router.callback_query(F.data == "contacts")
async def contacts_callback(callback: CallbackQuery):
    contacts_text = """
    *üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏*

    *ü§ù –†–µ–∫–ª–∞–º–∞ –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ:*
    @dianabol_metandienon_enjoyer

    *ü§ù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞:*
    @mattwix

    *ü§ù –ü—Ä–æ–±–ª–µ–º–º—ã —Å –ò–ò:*
    @andy_andy13

    *‚è∞ –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏:*
    –ü–Ω-–ü—Ç: 8:00 - 18:00 (–ú–°–ö)
    –°–±-–í—Å: –ø–æ –∑–∞–ø—Ä–æ—Å—É

    *üöÄ –ú—ã –ø–æ–º–æ–∂–µ–º:*
    ‚Ä¢ –°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å —Ä–µ–∫–ª–∞–º—É –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ
    ‚Ä¢ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
    ‚Ä¢ –û—Ç–≤–µ—Ç–∏–º –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ
    ‚Ä¢ –ü—Ä–∏–º–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é
    ‚Ä¢ –†–µ—à–∏–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

    *üìß –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã —Å–≤—è–∑–∏:*
    –î–ª—è —Å—Ä–æ—á–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Telegram
    """
    contacts_text = escape_markdown_v2(
        contacts_text
    )
    await callback.message.reply(
        text=contacts_text,
        reply_markup=inline_keyboards.home,
        parse_mode='MarkdownV2'
    )

@router.callback_query(F.data == "main_menu")
async def main_menu_callback(callback: CallbackQuery):
    await build_log_message(
        telegram_id=callback.from_user.id,
        action="callback",
        source="menu",
        payload="main_menu"
    )
    await callback.message.answer("–ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç üëá", reply_markup=inline_keyboards.main)
    await callback.answer()


#===========================================================================================================================
# –ö–∞—Ç–∞–ª–æ–≥
#===========================================================================================================================


@router.callback_query(F.data == "catalogue")
async def get_catalogue_menu(callaback:CallbackQuery):
    await callaback.message.answer(
        "–í—ã –º–æ–∂–µ—Ç–µ –∑–∞–¥–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã:",
        reply_markup=inline_keyboards.catalogue
    )