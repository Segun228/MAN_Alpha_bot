apiVersion: 1
groups:
  - name: Core API Health Checks
    orgId: 1
    folder: Core Services
    interval: '1m'
    rules:
      - uid: 'core-api-high-latency'
        title: 'Core API - Высокая задержка (p50)' 
        for: '5m'
        
        condition: B 
        
        data:
          - refId: A
            datasourceUid: 'Prometheus'
            model:
              expr: 'histogram_quantile(0.50, sum(rate(http_request_duration_seconds_bucket[5m])) by (le, job))'
              refId: A
            relativeTimeRange:
              from: 300
              to: 0
              
          - refId: B
            datasourceUid: '__expr__'
            model:
              type: threshold
              conditions:
                - evaluator:
                    params:
                      - 0.5
                    type: gt
                  operator:
                    type: and
                  query:
                    params:
                      - A
              refId: B
            relativeTimeRange:
              from: 300
              to: 0
              
        annotations:
          summary: 'Высокая медианная задержка (p50) Core API Gateway'
          description: 'Медианное время ответа API Gateway превышает 500 мс. Требуется проверка!'
        labels:
          severity: critical